<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  {{- block "meta" . }}
  {{ partialCached "meta.html" . }}
  {{ end -}}

{{- $uswdsInitJS := slice (resources.Get "/vendor/js/uswds-init.min.js") | resources.Concat "js/uswds-init.min.js" -}}
{{- $uswdsInitJSSecure := $uswdsInitJS | resources.Fingerprint "sha512" }}
  <script src="{{ $uswdsInitJS.RelPermalink }}" integrity="{{ $uswdsInitJSSecure.Data.Integrity }}"></script>

{{- $inServerMode := .Site.IsServer -}}
{{- $scss         := resources.Get "scss/styles.scss" -}}
{{- $sassIncludes := (slice "assets/vendor/scss/uswds/") -}}
{{- $vars := dict "siteBaseURL" $.Site.BaseURL -}}
{{- $cssTarget    := "css/hugo-uswds.css" -}}
{{- $cssOpts      := dict "transpiler" "dartsass" "targetPath" $cssTarget "includePaths" $sassIncludes "vars" $vars -}}
{{- if $inServerMode -}}
  {{- $cssOpts := merge $cssOpts (dict "enableSourceMap" true "sourceMapIncludeSources" true) -}}
{{- end -}}
{{- $postCSSOpts      := dict "use" "autoprefixer" -}}

{{- if $inServerMode -}}
  {{- $css := $scss | toCSS $cssOpts | postCSS $postCSSOpts }}
  <link rel="stylesheet" href="{{ $css.RelPermalink }}">
{{- else -}}
  {{- $css := $scss | toCSS $cssOpts | postCSS $postCSSOpts -}}
  {{- $cssFingerprint := $css | resources.Fingerprint "sha512" }}
  <link rel="stylesheet" href="{{ $cssFingerprint.RelPermalink }}" integrity="{{ $cssFingerprint.Data.Integrity }}">
{{- end -}}

{{ range .AlternativeOutputFormats }}
  {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
{{ end -}}

  <title>{{ block "title" . }}{{ .Title }}{{ end }}</title>
{{ template "_internal/google_analytics_async.html" . }}

{{- $jqueryJS := slice (resources.Get "/vendor/js/jquery.min.js") | resources.Concat "js/jquery.min.js" -}}
{{- $jqueryJSSecure := $jqueryJS | resources.Fingerprint "sha512" }}
  <script src="{{ $jqueryJS.RelPermalink }}" integrity="{{ $jqueryJSSecure.Data.Integrity }}"></script>

{{ block "head" . }}
  {{ partialCached "head.html" . }}
{{ end }}

{{- range .Site.Params.custom_css }}
  <link rel="stylesheet" href="{{ . | relURL }}" />
{{- end -}}

{{ range .Page.Params.custom_css }}
  <link rel="stylesheet" href="{{ . | relURL }}" />
{{- end -}}
</head>
<body>

{{- block "top-banner" . -}}
  {{ partialCached "top-banner.html" . }}
{{- end -}}
  
{{- if .Param "usabanner" }}{{ partialCached "components/usa-banner.html" . }}{{ end -}}
{{- with .Param "draftbanner" }}{{ partialCached "components/draft-banner.html" . }}{{ end -}}

{{- block "last-banner" . -}}
  {{ partialCached "last-banner.html" . }}
{{- end }}

{{- block "main" . -}}
<div>baseOf</div>
{{- partialCached "components/usa-header-extended.html" . -}}
{{- partial "site-content.html" . -}}
{{- end -}}

  <p class="font-sans-sm text-center" style="margin: 1.5rem auto">This page was last updated on {{ .Lastmod.Format "January 2, 2006" }}.{{ if .Site.Params.page_repo_path }} <button id="main-improve-page" onclick="window.location.href = '{{ .Site.Params.page_repo_path }}/{{ with .File }}{{ .Path }}{{ end }}';" class="usa-button usa-button--accent-cool">Improve this Page</button>{{ end }}</p>

{{- $uswdsJSmin := slice (resources.Get "/vendor/js/uswds.min.js") | resources.Concat "js/uswds.min.js" -}}
{{- $uswdsJSminSecure := $uswdsJSmin | resources.Fingerprint "sha512" }}
  <script type="text/javascript" src="{{ $uswdsJSminSecure.RelPermalink }}" integrity="{{ $uswdsJSminSecure.Data.Integrity }}"></script>

{{- range .Site.Params.custom_js }}
  <script src="{{ . | relURL }}"></script>
{{- end -}}

{{- range .Page.Params.custom_js }}
  <script src="{{ . | relURL }}"></script>
{{- end -}}

{{ $usingImageMap := .Page.Store.Get "hasImageMap" }}
{{- if $usingImageMap }}
  {{- $imageMapJS := slice (resources.Get "/vendor/js/imageMapResizer.min.js") | resources.Concat "js/imageMapResizer.min.js" -}}
  {{- $imageMapJSSecure := $imageMapJS | resources.Fingerprint "sha512" }}
  <script src="{{ $imageMapJS.RelPermalink }}" integrity="{{ $imageMapJSSecure.Data.Integrity }}"></script>
{{ end -}}

{{ $usingMermaid := .Page.Store.Get "hasMermaid" }}
{{ if $usingMermaid }}
  <script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/+esm'</script>
{{ end }}

{{ block "foot" . }}
{{ partialCached "foot.html" . }}
{{ end }}

{{ if or $usingMermaid $usingImageMap }}
<script>
$(document).ready(function(e) {
  {{ if $usingMermaid }}
  mermaid.initialize();
  {{ end }}
  {{ if $usingImageMap }}
  $('img[usemap]').imageMapResize();
  {{ end }}
});
</script>
{{ end }}

</body>
</html>
