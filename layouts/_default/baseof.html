<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  {{- block "meta" . }}
  {{ partialCached "meta.html" . }}
  {{ end -}}

{{- $uswdsInitJS := slice (resources.Get "/vendor/js/uswds-init.min.js") | resources.Concat "js/uswds-init.min.js" -}}
{{- $uswdsInitJSSecure := $uswdsInitJS | resources.Fingerprint "sha512" }}
  <script src="{{ $uswdsInitJS.RelPermalink }}" integrity="{{ $uswdsInitJSSecure.Data.Integrity }}"></script>

{{- $inServerMode := .Site.IsServer -}}
{{- $scss         := resources.Get "scss/styles.scss" -}}
{{- $sassIncludes := (slice "assets/vendor/scss/uswds/") -}}
{{- $vars := dict "siteBaseURL" $.Site.BaseURL -}}
{{- $cssTarget    := "css/hugo-uswds.css" -}}
{{- $cssOpts      := dict "transpiler" "dartsass" "targetPath" $cssTarget "includePaths" $sassIncludes "vars" $vars -}}
{{- if $inServerMode -}}
  {{- $cssOpts := merge $cssOpts (dict "enableSourceMap" true "sourceMapIncludeSources" true) -}}
{{- end -}}
{{- $postCSSOpts      := dict "use" "autoprefixer" -}}

{{- if $inServerMode -}}
  {{- $css := $scss | toCSS $cssOpts | postCSS $postCSSOpts }}
  <link rel="stylesheet" href="{{ $css.RelPermalink }}">
{{- else -}}
  {{- $css := $scss | toCSS $cssOpts | postCSS $postCSSOpts -}}
  {{- $cssFingerprint := $css | resources.Fingerprint "sha512" }}
  <link rel="stylesheet" href="{{ $cssFingerprint.RelPermalink }}" integrity="{{ $cssFingerprint.Data.Integrity }}">
{{- end -}}

{{ range .AlternativeOutputFormats }}
  {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
{{ end -}}

  <title>{{ block "title" . }}{{ .Title }}{{ end }}</title>
{{ template "_internal/google_analytics_async.html" . }}

{{- $jqueryJS := slice (resources.Get "/vendor/js/jquery.min.js") | resources.Concat "js/jquery.min.js" -}}
{{- $jqueryJSSecure := $jqueryJS | resources.Fingerprint "sha512" }}
  <script src="{{ $jqueryJS.RelPermalink }}" integrity="{{ $jqueryJSSecure.Data.Integrity }}"></script>

{{ block "head" . }}
  {{ partialCached "head.html" . }}
{{ end }}

{{- range .Site.Params.custom_css }}
  <link rel="stylesheet" href="{{ . | relURL }}" />
{{- end -}}

{{ range .Page.Params.custom_css }}
  <link rel="stylesheet" href="{{ . | relURL }}" />
{{- end -}}
</head>
<body>

{{- block "top-banner" . -}}
  {{ partialCached "top-banner.html" . }}
{{- end -}}
  
{{- if .Param "usabanner" }}{{ partialCached "components/usa-banner.html" . }}{{ end -}}
{{- with .Param "draftbanner" }}{{ partialCached "components/draft-banner.html" . }}{{ end -}}

{{- block "last-banner" . -}}
  {{ partialCached "last-banner.html" . }}
{{- end }}

{{ block "main" . }}
  {{ partialCached "components/usa-header-basic.html" . }}

  {{- $tocEnabled := true -}}
  {{- with .Page.Params.toc -}}
    {{- if isset . "enabled" -}}
      {{- $tocEnabled = true -}}
    {{- end -}}
  {{- end -}}
  {{- if $tocEnabled }}
<div class="usa-in-page-nav-container">
  <aside class="usa-in-page-nav"
    data-title-text="On this page"
    data-title-heading-level="h4"
    data-scroll-offset="0"
    data-root-margin="0px 0px 0px 0px"
    data-threshold="1"></aside>
  {{ end -}}
  <main class="usa-layout-docs usa-section" id="main-content">
    {{ .Content }}
  </main>
  {{- if $tocEnabled }}
</div>
  {{ end -}}
{{ end }}

  <p class="font-sans-sm text-center" style="margin: 1.5rem auto">This page was last updated on {{ .Lastmod.Format "January 2, 2006" }}.{{ if .Site.Params.page_repo_path }} <button id="main-improve-page" onclick="window.location.href = '{{ .Site.Params.page_repo_path }}/{{ with .File }}{{ .Path }}{{ end }}';" class="usa-button usa-button--accent-cool">Improve this Page</button>{{ end }}</p>
{{/*}}
{{ $tocEnabled := false }}
{{ with .Page.Params.toc }}
  {{ if isset . "enabled" }}
    {{ $tocEnabled = .enabled }}
  {{- end -}}
{{- end -}}
{{- if $tocEnabled -}}
  {{- $tocbotJS := slice (resources.Get "/vendor/js/tocbot.min.js") | resources.Concat "js/tocbot.min.js" -}}
  {{- $tocbotJSSecure := $tocbotJS | resources.Fingerprint "sha512" }}
  <script src="{{ $tocbotJS.RelPermalink }}" integrity="{{ $tocbotJSSecure.Data.Integrity }}"></script>
{{- end -}}
{{*/}}

{{- $uswdsJSmin := slice (resources.Get "/vendor/js/uswds.min.js") | resources.Concat "js/uswds.min.js" -}}
{{- $uswdsJSminSecure := $uswdsJSmin | resources.Fingerprint "sha512" }}
  <script type="text/javascript" src="{{ $uswdsJSminSecure.RelPermalink }}" integrity="{{ $uswdsJSminSecure.Data.Integrity }}"></script>

{{- range .Site.Params.custom_js }}
  <script src="{{ . | relURL }}"></script>
{{- end -}}

{{- range .Page.Params.custom_js }}
  <script src="{{ . | relURL }}"></script>
{{- end -}}

{{ $usingImageMap := .Page.Store.Get "hasImageMap" }}
{{- if $usingImageMap }}
  {{- $imageMapJS := slice (resources.Get "/vendor/js/imageMapResizer.min.js") | resources.Concat "js/imageMapResizer.min.js" -}}
  {{- $imageMapJSSecure := $imageMapJS | resources.Fingerprint "sha512" }}
  <script src="{{ $imageMapJS.RelPermalink }}" integrity="{{ $imageMapJSSecure.Data.Integrity }}"></script>
{{ end -}}

{{ $usingMermaid := .Page.Store.Get "hasMermaid" }}
{{ if $usingMermaid }}
  <script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/+esm'</script>
{{/*}}
  support vendoring mermaid
  {{- $mermaidJS := slice (resources.Get "/vendor/js/mermaid.esm.min.mjs") | resources.Concat "js/mermaid.esm.min.js" -}}
  {{- $mermaidJSSecure := $mermaidJS | resources.Fingerprint "sha512" }}
  <script src="{{ $mermaidJS.RelPermalink }}" integrity="{{ $mermaidJSSecure.Data.Integrity }}"></script>
{{*/}}
{{ end }}

{{ block "foot" . }}
{{ partialCached "foot.html" . }}
{{ end }}

{{ if or $usingMermaid $usingImageMap }}
<script>
$(document).ready(function(e) {
  {{ if $usingMermaid }}
  mermaid.initialize();
  {{ end }}
  {{ if $usingImageMap }}
  $('img[usemap]').imageMapResize();
  {{ end }}
});
</script>
{{ end }}

{{/*}}
{{- if $tocEnabled }}
<script>
  {{ $headingselectors := "h2,h3,h4" }}
  {{ $includeHtml := false }}
  {{ $collapseDepth := 0 }}
  {{ with .Page.Params.toc }}
    {{ if isset . "headingselectors" }}
      {{ $headingselectors = .headingselectors }}
    {{ end }}
    {{ with .includehtml }}
      {{ $includeHtml = . }}
    {{ end }}
    {{ if isset . "collapsedepth" }}
      {{ $collapseDepth = .collapsedepth }}
    {{ end }}
  {{ end }}
tocbot.init({
  tocSelector: '#js-toc',
  contentSelector: '#main-content',
  headingSelector: '{{ $headingselectors }}',
  includeHtml: {{ $includeHtml }},
  collapseDepth: {{- $collapseDepth -}},
  hasInnerContainers: true,
  orderedList: false,
  listClass: 'usa-sidenav',
//  activeListItemClass: 'usa-current',
  extraLinkClasses: 'usa-sidenav__item',
  activeLinkClass: 'usa-current',
  headingsOffset: 1,
  scrollSmoothOffset: 0
});
</script>
{{ end -}}
{{*/}}
</body>
</html>
